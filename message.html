<!DOCTYPE html>
<html lang="en">
<head>
  <title>P2P Network</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!-- <link rel="stylesheet" type="text/css" href="/static/vendor/bootstrap/css/bootstrap.min.css"> -->
  <link rel="stylesheet" type="text/css" href="/static/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/static/fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
  <link rel="stylesheet" type="text/css" href="/static/vendor/animate/animate.css">
  <link rel="stylesheet" type="text/css" href="/static/vendor/css-hamburgers/hamburgers.min.css">
  <link rel="stylesheet" type="text/css" href="/static/vendor/animsition/css/animsition.min.css">
  <link rel="stylesheet" type="text/css" href="/static/vendor/select2/select2.min.css">
  <link rel="stylesheet" type="text/css" href="/static/vendor/daterangepicker/daterangepicker.css">
  <link rel="stylesheet" type="text/css" href="/static/css/util.css">
  <link rel="stylesheet" type="text/css" href="/static/css/main.css">
  <link rel='stylesheet' href="/static/css/simplemde.min.css">
  <style type="text/css">
   
    .conversation-wrap
    {
        /*box-shadow: -2px 0 3px #ddd;
        padding:0;
        max-height: 400px;
        max-width: 400px*/
        overflow: auto;
        float: left;
        /*min-width: 260px;
        max-width: 450px;*/
        width: 25%;
        height: 90vh;
/*        background: #2c3e50;
        color: #f5f5f5;*/
/*        overflow: hidden;*/
        /*position: relative;*/
    }

    .media-hover:hover{
      background: lightgrey;
      color: white;
    }

    .conversation
    {
        padding:5px;
        border-bottom:1px solid #ddd;
        margin:0;   

    }

    .intro-screen-wrap
    {
        box-shadow: 0 0 3px #ddd;
        height: 400px;
        padding:0;

    }

    .message-wrap
    {
        /*box-shadow: 0 0 3px #ddd;
        padding:0;*/
        width: 75%;
        /*max-width: 65%;*/
        overflow: auto;
        float: right;
        height: 90vh;
    }

    .btn-attachments
    {
      float: left;
      width: 85%
    }

    .btn-message
    {
      float: right;
      width: 15%;
      text-align: center;
      
    }


    .msg
    {
        padding:5px;
        /*border-bottom:1px solid #ddd;*/
        margin:0;
    }
    .msg-wrap
    {
        padding:10px;
        height: 58vh;
        overflow: auto;

    }

    .time
    {
        color:#bfbfbf;
    }

    .send-wrap
    {
        border-top: 1px solid #eee;
        border-bottom: 1px solid #eee;
        padding:10px;
        /*background: #f8f8f8;*/
    }

    .send-message
    {
        resize: none;
    }

    .highlight
    {
        background-color: #f7f7f9;
        border: 1px solid #e1e1e8;
    }

    
    .btn-panel
    {
        background: #f7f7f9;
    }

    .btn-panel .btn
    {
        color:#b8b8b8;

        transition: 0.2s all ease-in-out;
    }

    .btn-panel .btn:hover
    {
        color:#666;
        background: #f8f8f8;
    }
    .btn-panel .btn:active
    {
        background: #f8f8f8;
        box-shadow: 0 0 1px #ddd;
    }

    .btn-panel-conversation .btn,.btn-panel-msg .btn
    {

        background: #f8f8f8;
    }
    .btn-panel-conversation .btn:first-child
    {
        border-right: 1px solid #ddd;
    }

    .msg-wrap .media-heading
    {
        color:#003bb3;
        font-weight: 700;
    }


    .msg-date
    {
        background: none;
        text-align: center;
        color:#aaa;
        border:none;
        box-shadow: none;
        border-bottom: 1px solid #ddd;
    }


    body::-webkit-scrollbar {
        width: 12px;
    }
 
    
    /* Let's get this party started */
    ::-webkit-scrollbar {
        width: 6px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3); 
/*        -webkit-border-radius: 10px;
        border-radius: 10px;*/
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
/*        -webkit-border-radius: 10px;
        border-radius: 10px;*/
        background:#ddd; 
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5); 
    }
    ::-webkit-scrollbar-thumb:window-inactive {
        background: #ddd; 
    }

    </style>

</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="/">Social Network</a>
    </div>
    <ul class="nav navbar-nav navbar-right">
      
    </ul>
  </div>
</nav>
  
<div class="container-fluid">
  <div class="conversation-wrap col-lg-3">
   <!--  <ul class="peernav"></ul> -->
    
  </div>

  <div class="message-wrap col-lg-12">
   <!--  <ul class="peernav"></ul> -->
   <div class="msg-wrap" id="your_div">
      
    </div>
    <div class='send-wrap '>
        <textarea name='message' id='message' form='usrform' class='form-control send-message' rows='3' placeholder='Message...'></textarea>
    </div>
    <div class='btn-panel'>
        <form accept-charset='UTF-8' action='/sendMessage' id='usrform' method='post' enctype='multipart/form-data'>
            <input type='file' class=' col-lg-6 btn btn-default btn-attachments' name='attachments' maxlength=50>
            <input type='submit' class=' col-lg-4 text-right btn btn-success btn-message' role='button' value='Send'/>
        </form>
    </div>
    <!-- <p>sdjzvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvbnsdvbjd
    vjscbb jb sdjb jsdb sdjbv jssb sb </p> -->
  <!-- </div> -->
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- <script type="text/javascript" src="static/js/jquery-1.11.1.min.js"></script> -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/static/vendor/animsition/js/animsition.min.js"></script>
<script src="/static/vendor/bootstrap/js/popper.js"></script>
<!-- <script src="static/vendor/bootstrap/js/bootstrap.min.js"></script> -->
<script src="/static/vendor/select2/select2.min.js"></script>
<script src="/static/vendor/daterangepicker/moment.min.js"></script>
<script src="/static/vendor/daterangepicker/daterangepicker.js"></script>
<script src="/static/vendor/countdowntime/countdowntime.js"></script>
<script src="/static/js/main.js"></script>  
<script type="text/javascript" src="/static/js/handlebars-v4.0.10.js"></script>
<script id="username-template" type="x-handlebars-template">
<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="">
  <span class="glyphicon glyphicon-user"></span>
  {{username}}
  <span class="caret"></span></a>
  <ul class="dropdown-menu">
    <li><a href="/viewProfile/?username={{username}}">View Profile</a></li>
    <li><a href="/editProfile">Edit Profile</a></li>
  </ul>
</li>

<li><a href="/signout"><span class="glyphicon glyphicon-log-in"></span> Logoff</a></li>
</script>
<script id="userList-template" type="x-handlebars-template">
  {{#each this}}
  <div class="media conversation">
  <a class="pull-left" href="/viewProfile/?username={{username}}"><img class="media-object" data-src="/static/js/holder.js/64x64" alt="profilepic" style="width: 32px; height: 32px;" src="{{picture}}""></a>            
    <div class="media-body media-hover">
      <a href="/message/?username={{username}}">
        <span style="display: block;">
        <h5 class="media-heading">{{username}}</h5>
        {{#if onlineStatus}}
          <i class="fa fa-square" style="font-size:12px;color:green"></i>
        {{else}}
          <i class="fa fa-square" style="font-size:12px;color:red"></i>
        {{/if}}
        <small>Active: {{lastLogin}}</small>
        </span>
      </a>
    </div>
</div>
{{/each}}
</script>
<script id="messagelist-template" type="x-handlebars-template">
  {{#each this}}
  <div class="media msg" id="marksdiv">
      
      <div class="media-body">
          <h5 class="media-heading">{{username}}</h5>
          <p class="col-lg-10">{{{message}}}</p>
          <small class="pull-left time">
          <i class="fa fa-clock-o"></i> {{stamp}}<br>
          <i class="fa fa-envelope-o"></i> {{messageStatus}}</small>
      </div>
  </div>
  {{/each}}
</script>
<script>
$(function update() {
  $.getJSON(window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/getSelfUsername', function(data) {
    $(".navbar-right").html("");
    var template = $("#username-template").html();
    var templateScript = Handlebars.compile(template);
    var html = templateScript(data)
    $(".navbar-right").append(html); 
  });
  $.getJSON(window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/getUserListJSON', function(data) {
    $(".conversation-wrap").html("");
    var template = $("#userList-template").html();
    // console.log(data);
    // console.log(template);
    var templateScript = Handlebars.compile(template);
    var html = templateScript(data);
    $(".conversation-wrap").append(html); 
    window.setTimeout(update, 30000);

  });
});
$(function() {
  $.getJSON(window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/getMessageListJSON', function(data) {
    $(".msg-wrap").html("");
    var template = $("#messagelist-template").html();
    var templateScript = Handlebars.compile(template);
    var html = templateScript(data)
    $(".msg-wrap").append(html); 
    $('.msg-wrap').scrollTop($('.msg-wrap')[0].scrollHeight);
    // window.setTimeout(updateMessages, 30000);
  });
});
$(function updateMessages() {
  $.getJSON(window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/getRefreshBoolean', function(data) {
    if (data['refreshMsg']){
      $.getJSON(window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/getMessageListJSON', function(data) {
        $(".msg-wrap").html("");
        var template = $("#messagelist-template").html();
        var templateScript = Handlebars.compile(template);
        var html = templateScript(data)
        $(".msg-wrap").append(html); 
        $('.msg-wrap').scrollTop($('.msg-wrap')[0].scrollHeight);
        // window.setTimeout(updateMessages, 30000);
      });
    }
    window.setTimeout(updateMessages, 5000);
  });
});
</script>
<script src="/static/js/simplemde.min.js"></script>
<script>new SimpleMDE({ element: document.getElementById('message'), spellChecker: false, toolbar: false,});</script>

</body>
</html>
